# IELTS Listening Test Platform - Complete Codebase Index

## üìã Project Overview
Complete IELTS Listening practice test platform with admin management, student authentication, real-time test control, and auto-grading system.

---

## üèóÔ∏è Architecture

### Tech Stack
- **Frontend**: React 18 with React Router, Tailwind CSS, Recharts
- **Backend**: FastAPI (Python) with async/await
- **Database**: MongoDB + Firebase Realtime Database
- **Authentication**: Firebase Google OAuth
- **File Storage**: Local file system for audio tracks

### Service Ports
- **Frontend**: Port 3000 (React Dev Server)
- **Backend**: Port 8001 (FastAPI with Uvicorn)
- **MongoDB**: Port 27017 (Internal)

---

## üìÅ Directory Structure

```
/app/
‚îú‚îÄ‚îÄ backend/                      # FastAPI Backend
‚îÇ   ‚îú‚îÄ‚îÄ server.py                # Main API server (1145 lines)
‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py          # Authentication & session management
‚îÇ   ‚îú‚îÄ‚îÄ init_ielts_test.py      # Initialize default IELTS test
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt         # Python dependencies
‚îÇ
‚îú‚îÄ‚îÄ frontend/                     # React Frontend
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/          # Admin Panel Components
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminDashboard.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminLogin.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminRouter.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AudioUpload.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FirebaseSubmissionReview.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QuestionManager.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudentManagement.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SubmissionManagement.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TestManagement.jsx  # ‚≠ê Test Start/Stop Controls
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ student/        # Student Components
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CompleteProfile.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProgressChart.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudentDashboard.jsx  # ‚≠ê Shows test status & polling
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudentHome.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WaitingForApproval.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/         # Shared Components
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProtectedRoute.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Toast.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ExamTest.jsx    # Main exam interface
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Homepage.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ListeningInstructions.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ListeningTest.jsx  # Exam UI with timer
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SoundTest.jsx
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/           # API Service Layer
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BackendService.js      # ‚≠ê FastAPI endpoints
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FirebaseAuthService.js  # Firebase auth
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FirebaseService.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AudioService.js
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.jsx       # Global auth state
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ firebase.js          # Firebase configuration
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.js               # Main app with routing
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js             # React entry point
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ public/                  # Static assets
‚îÇ   ‚îú‚îÄ‚îÄ package.json            # Node dependencies
‚îÇ   ‚îî‚îÄ‚îÄ tailwind.config.js      # Tailwind configuration
‚îÇ
‚îú‚îÄ‚îÄ listening_tracks/            # Audio file storage
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îî‚îÄ‚îÄ .gitignore
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ create_ielts_test.py    # Test creation script
‚îÇ
‚îú‚îÄ‚îÄ tests/                       # Test files
‚îÇ
‚îî‚îÄ‚îÄ Documentation Files
    ‚îú‚îÄ‚îÄ README.md                # Main project documentation
    ‚îú‚îÄ‚îÄ CODEBASE_INDEX.md       # This file
    ‚îú‚îÄ‚îÄ test_result.md          # Testing logs & task tracking
    ‚îú‚îÄ‚îÄ FIREBASE_DEPLOYMENT.md
    ‚îú‚îÄ‚îÄ FIREBASE_MIGRATION_SUMMARY.md
    ‚îú‚îÄ‚îÄ STUDENT_APPROVAL_SYSTEM.md
    ‚îú‚îÄ‚îÄ SUBMISSION_MANAGEMENT_GUIDE.md
    ‚îú‚îÄ‚îÄ ADMIN_QUICK_GUIDE.md
    ‚îî‚îÄ‚îÄ [Other documentation files]
```

---

## üîë Key Features Implementation

### 1. ‚≠ê Test Control System (Start/Stop Tests)

#### Backend Endpoints
**Location**: `/app/backend/server.py` (Lines 1032-1137)

```python
# Admin Only - Start Test
PUT /api/admin/exams/{exam_id}/start
- Sets is_active = True
- Records started_at timestamp
- Requires admin authentication

# Admin Only - Stop Test
PUT /api/admin/exams/{exam_id}/stop
- Sets is_active = False
- Records stopped_at timestamp
- Requires admin authentication

# Public - Poll Test Status
GET /api/exams/{exam_id}/status
- Returns is_active, started_at, stopped_at, published
- No authentication required
- Used by students for real-time status checking
```

#### Frontend Admin Interface
**Location**: `/app/frontend/src/components/admin/TestManagement.jsx` (Lines 118-144, 230-254)

**Features:**
- Green "Start" button when test is inactive
- Red "Stop" button when test is active
- Only appears for published tests
- Shows toast notifications on success/failure
- Updates exam list in real-time

**Functions:**
- `handleStartTest(testId)` - Calls BackendService.startExam()
- `handleStopTest(testId)` - Calls BackendService.stopExam() with confirmation

#### Frontend Student Interface
**Location**: `/app/frontend/src/components/student/StudentDashboard.jsx` (Lines 71-98, 246-249)

**Features:**
- Polls exam status every 3 seconds using `useEffect` hook
- Shows yellow banner: "Please wait for the test to begin." when test is not active
- Disables "Start Exam" button until test is active
- Button states:
  - ‚úÖ "Start Exam" (blue) - When test is active and not completed
  - ‚ùå "Test Not Active" (gray) - When test is inactive
  - üîí "Already Completed" (gray) - When student has completed

**Polling Logic:**
```javascript
useEffect(() => {
  const pollStatuses = async () => {
    for (const exam of exams) {
      const status = await BackendService.getExamStatus(exam.id);
      statuses[exam.id] = status;
    }
    setExamStatuses(statuses);
  };
  
  pollStatuses(); // Initial poll
  const interval = setInterval(pollStatuses, 3000); // Poll every 3s
  return () => clearInterval(interval);
}, [exams]);
```

#### Service Layer
**Location**: `/app/frontend/src/services/BackendService.js` (Lines 101-129)

```javascript
BackendService = {
  startExam: async (examId) => {
    const response = await api.put(`/admin/exams/${examId}/start`);
    return response.data;
  },
  
  stopExam: async (examId) => {
    const response = await api.put(`/admin/exams/${examId}/stop`);
    return response.data;
  },
  
  getExamStatus: async (examId) => {
    const response = await api.get(`/exams/${examId}/status`);
    return response.data;
  }
}
```

---

### 2. üéì Student Authentication & Management

#### Firebase Google OAuth
**Location**: `/app/frontend/src/services/FirebaseAuthService.js`

**Features:**
- Google Sign-In integration
- Admin whitelist (aminulislam004474@gmail.com, shahsultanweb@gmail.com)
- Profile completion workflow
- Student approval system (pending ‚Üí approved/rejected)
- Submission tracking

#### Student Dashboard
**Location**: `/app/frontend/src/components/student/StudentDashboard.jsx`

**Features:**
- Available exams list with real-time status
- Submission history with scores
- Progress chart (Recharts bar chart)
- Statistics cards
- One-time exam attempt enforcement

---

### 3. üìù Exam Management

#### Test Management
**Location**: `/app/frontend/src/components/admin/TestManagement.jsx`

**Features:**
- Create/Edit/Delete exams
- Publish/Unpublish
- Start/Stop test controls
- Search functionality
- Question count and duration display

#### Question Manager
**Location**: `/app/frontend/src/components/admin/QuestionManager.jsx`

**Features:**
- 4 sections management
- Question CRUD operations
- Supports 4 question types:
  - Short Answer
  - Multiple Choice
  - Map Labeling (with images)
  - Diagram Labeling (with images)
- Audio upload integration

---

### 4. üéµ Audio System

#### Audio Upload
**Location**: `/app/frontend/src/components/admin/AudioUpload.jsx`

**Features:**
- File upload to `/listening_tracks/` directory
- Supports MP3, WAV, M4A, OGG, FLAC
- Backend endpoint: POST /api/upload-audio
- UUID-based file naming
- Static file serving at /listening_tracks/

**Backend Implementation:**
**Location**: `/app/backend/server.py` (Lines 950-980)

---

### 5. ‚úÖ Auto-Grading System

**Location**: `/app/backend/server.py` (Submission creation endpoint)

**Features:**
- Automatic answer comparison
- Case-insensitive for short_answer/diagram_labeling
- Exact match for multiple_choice/map_labeling
- Calculates score and percentage
- Stores correct_answers count

---

### 6. üìä Submission Management

#### Admin Submission Review
**Location**: `/app/frontend/src/components/admin/SubmissionManagement.jsx`

**Features:**
- View all submissions
- Filter by student/exam/status
- Sort by date/score/percentage
- Manual score editing
- CSV export
- Pass/Fail badges
- Progress bars

#### Backend Endpoints
```python
GET /api/submissions/{id}/detailed  # Full submission with questions
PUT /api/submissions/{id}/score     # Update score manually (admin only)
GET /api/exams/{exam_id}/submissions # All submissions for exam
```

---

### 7. ‚è±Ô∏è Enhanced Timer System

**Location**: `/app/frontend/src/components/ListeningTest.jsx`

**Features:**
- 3D gradient design with shadow effects
- Red/white pulsing animation in final 2 minutes
- Auto-submit when timer expires
- Completion screen
- Dynamic padding for fixed header

**Tailwind Animation:**
**Location**: `/app/frontend/tailwind.config.js`

```javascript
keyframes: {
  'timer-fade': {
    '0%, 100%': { backgroundColor: '#ef4444', color: '#fff' },
    '50%': { backgroundColor: '#fef2f2', color: '#ef4444' }
  }
}
```

---

## üîê Authentication Flow

### Admin Flow
1. Navigate to `/admin/login`
2. Sign in with Google OAuth
3. Check email against whitelist
4. Redirect to `/admin/dashboard`

### Student Flow
1. Navigate to `/student/login`
2. Sign in with Google OAuth
3. If new user ‚Üí Complete profile ‚Üí Approval pending
4. If approved ‚Üí Student dashboard
5. Select exam ‚Üí Wait for admin to start ‚Üí Take test ‚Üí View results

---

## üóÑÔ∏è Database Schema

### MongoDB Collections

#### Exams
```javascript
{
  id: "uuid",
  title: "string",
  description: "string",
  duration: 2004, // seconds
  question_count: 40,
  audio_url: "string",
  published: true,
  is_active: false,  // ‚≠ê Test control
  started_at: null,  // ‚≠ê Test control
  stopped_at: null,  // ‚≠ê Test control
  created_at: "timestamp",
  updated_at: "timestamp"
}
```

#### Sections
```javascript
{
  id: "uuid",
  exam_id: "uuid",
  section_number: 1,
  title: "Section 1",
  description: "string"
}
```

#### Questions
```javascript
{
  id: "uuid",
  section_id: "uuid",
  index: 1,
  question_type: "short_answer|multiple_choice|map_labeling|diagram_labeling",
  prompt: "string",
  options: ["A", "B", "C", "D"],  // for multiple choice
  image_url: "string",  // for map/diagram labeling
  answer_key: "correct_answer"
}
```

#### Submissions
```javascript
{
  id: "uuid",
  exam_id: "uuid",
  student_id: "uuid", // Firebase UID
  answers: {"1": "answer1", "2": "answer2", ...},
  score: 35,
  total_questions: 40,
  correct_answers: 35,
  manually_graded: false,
  submitted_at: "timestamp"
}
```

### Firebase Realtime Database

#### Students
```javascript
/students/{uid}
{
  uid: "string",
  email: "string",
  displayName: "string",
  photoURL: "string",
  phone: "string",
  institution: "string",
  department: "string",
  rollNumber: "string",
  status: "pending|approved|rejected|inactive",
  createdAt: "timestamp"
}
```

#### Submissions (Firebase)
```javascript
/submissions/{submissionId}
{
  examId: "string",
  studentId: "uid",
  examTitle: "string",
  score: 35,
  totalQuestions: 40,
  submittedAt: "timestamp"
}
```

---

## üöÄ Running the Application

### Start All Services
```bash
sudo supervisorctl restart all
```

### Individual Services
```bash
sudo supervisorctl restart frontend
sudo supervisorctl restart backend
```

### Check Status
```bash
sudo supervisorctl status
```

### View Logs
```bash
# Backend logs
tail -f /var/log/supervisor/backend.*.log

# Frontend logs
tail -f /var/log/supervisor/frontend.*.log
```

---

## üîß Development Workflow

### Backend Development
1. Edit `/app/backend/server.py`
2. Hot reload enabled (FastAPI auto-reloads)
3. Check logs: `tail -f /var/log/supervisor/backend.*.log`

### Frontend Development
1. Edit files in `/app/frontend/src/`
2. Hot reload enabled (React Dev Server)
3. Changes reflect immediately in browser

### Database Changes
1. Backend connects via `MONGO_URL` env variable
2. Firebase config in `/app/frontend/src/config/firebase.js`

---

## üìù Important Files to Modify

### Change Test Status Message
**File**: `/app/frontend/src/components/student/StudentDashboard.jsx`
**Line**: 248
```jsx
// Changed from: "Waiting for admin to start this test..."
// Changed to: "Please wait for the test to begin."
```

### Add Admin Emails
**File**: `/app/backend/server.py`
**Variable**: `ADMIN_EMAILS`

### Modify Test Control
**Files**:
- Backend: `/app/backend/server.py` (lines 1032-1137)
- Frontend Admin: `/app/frontend/src/components/admin/TestManagement.jsx`
- Frontend Student: `/app/frontend/src/components/student/StudentDashboard.jsx`
- Service: `/app/frontend/src/services/BackendService.js`

---

## üß™ Testing

### Backend Testing
Use the testing agent to test backend endpoints:
- Test control endpoints (start/stop/status)
- Submission endpoints
- Exam CRUD operations

### Frontend Testing
Manual testing workflow:
1. Admin login ‚Üí Start test
2. Student login ‚Üí See "Please wait for test to begin" message
3. Verify button is disabled
4. Admin starts test
5. Student polls status (every 3s)
6. Button becomes enabled
7. Student takes test

---

## üìö Key Documentation Files

1. **test_result.md** - Complete testing logs and task tracking
2. **FIREBASE_DEPLOYMENT.md** - Firebase deployment guide
3. **STUDENT_APPROVAL_SYSTEM.md** - Approval workflow documentation
4. **SUBMISSION_MANAGEMENT_GUIDE.md** - Admin submission management
5. **ADMIN_QUICK_GUIDE.md** - Quick reference for admins

---

## ‚úÖ Recent Changes (Current Session)

### 1. Text Update
**File**: `/app/frontend/src/components/student/StudentDashboard.jsx`
**Line**: 248
**Change**: "Waiting for admin to start this test..." ‚Üí "Please wait for the test to begin."
**Status**: ‚úÖ Completed, frontend restarted

### 2. Test Control Verification
**Status**: ‚úÖ Verified - All components working:
- Backend endpoints exist and tested
- Admin UI has Start/Stop buttons
- Student UI has polling mechanism
- Service layer methods implemented

---

## üéØ System Status

### Services
- ‚úÖ Backend: RUNNING (pid 447, uptime 0:02:19)
- ‚úÖ Frontend: RUNNING (pid 527, uptime 0:01:48)
- ‚úÖ MongoDB: RUNNING (pid 42, uptime 0:06:37)
- ‚úÖ Code Server: RUNNING (pid 39, uptime 0:06:37)

### Features
- ‚úÖ Test Control System (Start/Stop)
- ‚úÖ Student Status Polling (3 second interval)
- ‚úÖ Auto-grading System
- ‚úÖ Manual Score Editing
- ‚úÖ Firebase Authentication
- ‚úÖ Student Approval Workflow
- ‚úÖ Progress Charts
- ‚úÖ Enhanced Timer with Auto-submit
- ‚úÖ Audio Upload System
- ‚úÖ Submission Management

---

## üîó Quick Links

### URLs
- Frontend: http://localhost:3000
- Backend API: http://localhost:8001/api
- API Docs: http://localhost:8001/docs

### Admin Emails
- aminulislam004474@gmail.com
- shahsultanweb@gmail.com

### Default Test
- ID: ielts-listening-practice-test-1
- Title: IELTS Listening Practice Test 1
- Duration: 2004 seconds (33:24 min)
- Questions: 40

---

**Last Updated**: Current Session
**Codebase Status**: ‚úÖ Fully Indexed and Documented
